C51 COMPILER V9.60.7.0   MAIN                                                              08/16/2025 18:01:07 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: C:\keil_C51\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\mai
                    -n.lst) TABS(2) OBJECT(.\Objects\main.obj)

line level    source

   1          #include <REGX52.H>
   2          #include "Timer0.h"
   3          #include "NonBlockKey.h"
   4          #include "MatrixLED.h"
   5          #include "delay.h"
   6          #include "score.h"
   7          #include "stdlib.h"
   8          
   9          //ç‚¹é˜µå±å‚æ•°ï¼š8*8
  10          #define GAME_WIDTH    8   //8åˆ—
  11          #define GAME_HEIGHT   8   //8è¡Œ
  12          
  13          //æ–¹å—çŠ¶æ€ã€å½¢çŠ¶æ•°ç»„
  14          //æ ¼å¼ï¼š[å½¢çŠ¶ç±»å‹][æ—‹è½¬çŠ¶æ€][è¡Œ][åˆ—]
  15          unsigned char code Block[4][4][3][3] = {
  16              //1.å•ç‚¹æ–¹å—
  17              {
  18                //r0
  19               {
  20                {0,0,0},
  21                {0,1,0},
  22                {0,0,0}
  23               },
  24                //r90
  25               {
  26                {0,0,0},
  27                {0,1,0},
  28                {0,0,0}
  29               },
  30                //r180
  31               {
  32                {0,0,0},
  33                {0,1,0},
  34                {0,0,0}
  35               },
  36                //r270
  37               {
  38                {0,0,0},
  39                {0,1,0},
  40                {0,0,0}
  41               },
  42              },
  43              
  44              //2.åŒç‚¹æ–¹å—
  45              {
  46                //r0
  47               {
  48                {0,0,0},
  49                {1,1,0},
  50                {0,0,0}
  51               },
  52                //r90
  53               {
  54                {0,1,0},
C51 COMPILER V9.60.7.0   MAIN                                                              08/16/2025 18:01:07 PAGE 2   

  55                {0,1,0},
  56                {0,0,0}
  57               },
  58                //r180
  59               {
  60                {0,0,0},
  61                {0,1,1},
  62                {0,0,0}
  63               },
  64                //r270
  65               {
  66                {0,0,0},
  67                {0,1,0},
  68                {0,1,0}
  69               },
  70              },
  71              
  72              //3.Lå½¢ä¸‰ç‚¹æ–¹å—
  73              {
  74                //r0
  75               {
  76                {0,1,0},
  77                {0,1,1},
  78                {0,0,0}
  79               },
  80                //r90
  81               {
  82                {0,0,0},
  83                {0,1,1},
  84                {0,1,0}
  85               },
  86                //r180
  87               {
  88                {0,0,0},
  89                {1,1,0},
  90                {0,1,0}
  91               },
  92                //r270
  93               {
  94                {0,1,0},
  95                {1,1,0},
  96                {0,0,0}
  97               },
  98              },
  99              
 100              //4.Tå½¢å››ç‚¹æ–¹å—
 101              {
 102                //r0
 103               {
 104                {0,1,0},
 105                {1,1,1},
 106                {0,0,0}
 107               },
 108                //r90
 109               {
 110                {0,1,0},
 111                {0,1,1},
 112                {0,1,0}
 113               },
 114                //r180
 115               {
 116                {0,0,0},
C51 COMPILER V9.60.7.0   MAIN                                                              08/16/2025 18:01:07 PAGE 3   

 117                {1,1,1},
 118                {0,1,0}
 119               },
 120                //r270
 121               {
 122                {0,1,0},
 123                {1,1,0},
 124                {0,1,0}
 125               },
 126              }
 127          
 128          };
 129          
 130          //æ¸¸æˆçŠ¶æ€å˜é‡
 131          //1.æ ‡å¿—ç±»å˜é‡
 132          bit isGameOver = 0;                                                 //æ¸¸æˆç»“æŸæ ‡å¿—
 133          bit isPaused = 0;                                                   //æ¸¸æˆæš‚åœæ ‡å¿—
 134          bit blockFallFlag = 0;                                              //æ–¹å—ä¸‹è½æ ‡å¿—
 135          bit gameOverAnimState = 0;                                          //æ¸¸æˆç»“æŸåŠ¨ç”»çŠ¶æ€
 136          //2.å‚æ•°ç±»å˜é‡
 137          unsigned char gameArea[GAME_WIDTH + 1][GAME_HEIGHT + 1] = {0};      //æ¸¸æˆåŒºåŸŸå‚æ•°ï¼ˆ0ï¼šç©ºï¼Œ1ï¼šæ–¹å
             -—ï¼‰
 138          unsigned char curBlockType;                                         //å½“å‰æ–¹å—ç±»å‹ï¼ˆ0-3ï¼‰
 139          unsigned char curRotate;                                            //å½“å‰æ–¹å—æ—‹è½¬ç±»å‹ï¼ˆ0-3ï¼‰
 140          unsigned char curX, curY;                                           //å½“å‰æ–¹å—åæ ‡
 141          unsigned char nextBlockType;                                        //ä¸‹ä¸€ä¸ªæ–¹å—ç±»å‹
 142          unsigned char newY, newX;                                           //æ›´æ–°åçš„æ–¹å—åæ ‡
 143          unsigned char key;                                                  //è¯»å–æŒ‰é”®é”®ç 
 144          unsigned int gameOverAnimCount = 0;                                 //æ¸¸æˆç»“æŸåŠ¨ç”»è®¡æ•°å™¨
 145          
 146          
 147          /**
 148           * @brief  åˆå§‹åŒ–æ¸¸æˆçŠ¶æ€
 149           * @param  æ— 
 150           * @retval æ— 
 151           */
 152          void GameInit(){
 153   1          unsigned char col, row;
 154   1          isGameOver = 0;
 155   1          isPaused = 0;
 156   1          gameOverAnimCount = 0;
 157   1          gameOverAnimState = 0;
 158   1          Score_Init();       //ç§¯åˆ†ç³»ç»Ÿåˆå§‹åŒ–
 159   1          Timer0Init();       //å®šæ—¶å™¨åˆå§‹åŒ–
 160   1          MatrixLED_Init();   //8*8ç‚¹é˜µå±åˆå§‹åŒ–
 161   1          srand(TH0);         //ä»¥å®šæ—¶å™¨åˆå§‹å€¼ä½œä¸ºéšæœºæ•°ç§å­
 162   1          
 163   1          //æ¸…ç©ºæ¸¸æˆåŒºåŸŸ
 164   1          for(col = 0; col < GAME_WIDTH; col++){
 165   2              for(row = 0; row < GAME_HEIGHT; row++){
 166   3                  gameArea[col][row] = 0;
 167   3              }
 168   2          }
 169   1          
 170   1          //åˆå§‹åŒ–æ–¹å—ç”Ÿæˆ
 171   1          curBlockType = rand() % 4;
 172   1          curRotate = rand() % 4;
 173   1          curX = 3;     //Xåˆå€¼
 174   1          curY = 7;     //Yåˆå€¼
 175   1          nextBlockType = rand() % 4;
 176   1      }
 177          
C51 COMPILER V9.60.7.0   MAIN                                                              08/16/2025 18:01:07 PAGE 4   

 178          /**
 179           * @brief  ç»˜åˆ¶æ¸¸æˆç”»é¢
 180           * @param  æ— 
 181           * @retval æ— 
 182           */
 183          void DrawGame(){
 184   1          unsigned char frame[8] = {0};  //å¸§ç¼“å­˜ï¼Œ8åˆ—ï¼Œæ¯åˆ—1å­—èŠ‚ï¼ˆbit7=æœ€ä¸Šè¡Œï¼Œbit0=æœ€ä¸‹è¡Œï¼‰
 185   1          unsigned char col, row, r, c, realCol, realRow;
 186   1          
 187   1          //1.ç»˜åˆ¶æ¸¸æˆåŒºåŸŸä¸­å·²å›ºå®šçš„æ–¹å—
 188   1          for(col = 0; col < GAME_WIDTH; col++){
 189   2              for(row = 0; row < GAME_HEIGHT; row++){
 190   3                  if(gameArea[col][row] == 1){
 191   4                      //è¡Œå·rowå¯¹åº”bitä½ï¼ˆrow=0â†’bit0ï¼Œrow=7â†’bit7ï¼‰ï¼Œç½®1è¡¨ç¤ºç‚¹äº®
 192   4                      frame[col] |= (1 << row);
 193   4                  }
 194   3              }
 195   2          }
 196   1          
 197   1          //2.ç»˜åˆ¶å½“å‰æ´»åŠ¨æ–¹å—ï¼ˆ3x3çŸ©é˜µï¼‰
 198   1          for(r = 0; r < 3; r++){  //éå†æ–¹å—çš„3è¡Œ
 199   2              for(c = 0; c < 3; c++){  //éå†æ–¹å—çš„3åˆ—
 200   3                  //è‹¥æ–¹å—å½“å‰ä½ç½®æœ‰åƒç´ ï¼ˆ1è¡¨ç¤ºæœ‰æ–¹å—ï¼‰
 201   3                  if(Block[curBlockType][curRotate][r][c] == 1){
 202   4                      //è®¡ç®—å®é™…åæ ‡ï¼ˆä»¥æ–¹å—ä¸­å¿ƒä¸ºåŸºå‡†åç§»ï¼Œ3x3çŸ©é˜µä¸­å¿ƒåœ¨(1,1)ï¼‰
 203   4                      realCol = curX + (c - 1);  //åˆ—åæ ‡ï¼šå½“å‰åˆ— + åˆ—åç§»
 204   4                      realRow = curY + (r - 1);  //è¡Œåæ ‡ï¼šå½“å‰è¡Œ + è¡Œåç§»
 205   4                      
 206   4                      //ç¡®ä¿åæ ‡åœ¨8x8ç‚¹é˜µèŒƒå›´å†…ï¼ˆé˜²æ­¢è¶Šç•Œï¼‰
 207   4                      if(realCol < GAME_WIDTH && realRow < GAME_HEIGHT){
 208   5                          frame[realCol] |= (1 << realRow);  //ç‚¹äº®å¯¹åº”åƒç´ 
 209   5                      }
 210   4                  }
 211   3              }
 212   2          }
 213   1          
 214   1          //3.æ˜¾ç¤ºæœ€ç»ˆå¸§ç¼“å­˜
 215   1          MatrixLED_ShowFrame(frame);
 216   1      }
 217          
 218          /**
 219           * @brief  æ£€æµ‹æ–¹å—ç§»åŠ¨åˆ°ç›®æ ‡ä½ç½®æ˜¯å¦ç¢°æ’
 220           * @param  x ç›®æ ‡Xåæ ‡
 221           * @param  y ç›®æ ‡Yåæ ‡
 222           * @retval 1-ç¢°æ’ï¼Œ0-æ— ç¢°æ’
 223           */
 224          bit CheckCollision(unsigned char x, unsigned char y){
 225   1          unsigned char r, c;
 226   1          for(r = 0; r < 3; r++){  //éå†æ–¹å—3x3çŸ©é˜µ
 227   2              for(c = 0; c < 3; c++){
 228   3                  if(Block[curBlockType][curRotate][r][c] == 1){  //æ–¹å—å½“å‰ä½ç½®æœ‰åƒç´ 
 229   4                      unsigned char realCol = x + (c - 1);  //è®¡ç®—å®é™…åˆ—åæ ‡
 230   4                      unsigned char realRow = y + (r - 1);  //è®¡ç®—å®é™…è¡Œåæ ‡
 231   4                      
 232   4                      //æ£€æµ‹æ˜¯å¦è¶…å‡ºå·¦å³è¾¹ç•Œï¼ˆåˆ—0-7ï¼‰
 233   4                      if(realCol >= GAME_WIDTH || realCol < 0){
 234   5                          return 1;  //è¶…å‡ºè¾¹ç•Œï¼Œç¢°æ’
 235   5                      }
 236   4                      
 237   4                      //æ£€æµ‹æ˜¯å¦è¶…å‡ºä¸‹è¾¹ç•Œï¼ˆè¡Œ0-7ï¼‰ï¼Œå…è®¸è¶…å‡ºä¸Šè¾¹ç•Œ
 238   4                      if(realRow > GAME_HEIGHT){
 239   5                          return 1;  //è¶…å‡ºä¸‹è¾¹ç•Œï¼Œç¢°æ’
C51 COMPILER V9.60.7.0   MAIN                                                              08/16/2025 18:01:07 PAGE 5   

 240   5                      }
 241   4                      
 242   4                      //åªæœ‰å½“è¡Œåæ ‡åœ¨æœ‰æ•ˆèŒƒå›´å†…æ—¶ï¼Œæ‰æ£€æµ‹ä¸å·²å›ºå®šæ–¹å—çš„ç¢°æ’
 243   4                      if(realRow >= 0 && gameArea[realCol][realRow] == 1){
 244   5                          return 1;  //é‡å ï¼Œç¢°æ’
 245   5                      }
 246   4                  }
 247   3              }
 248   2          }
 249   1          return 0;  //æ— ç¢°æ’
 250   1      }
 251          
 252          /**
 253           * @brief  å°†å½“å‰æ´»åŠ¨æ–¹å—å›ºå®šåˆ°æ¸¸æˆåŒºåŸŸ
 254           * @param  æ— 
 255           * @retval æ— 
 256           */
 257          void FixBlock(){
 258   1          unsigned char r, c;
 259   1          for(r = 0; r < 3; r++){
 260   2              for(c = 0; c < 3; c++){
 261   3                  if(Block[curBlockType][curRotate][r][c] == 1){
 262   4                      unsigned char realCol = curX + (c - 1);
 263   4                      unsigned char realRow = curY + (r - 1);
 264   4                      //åœ¨æœ‰æ•ˆåŒºåŸŸå†…å›ºå®šæ–¹å—
 265   4                      if(realCol < GAME_WIDTH && realRow < GAME_HEIGHT){
 266   5                          gameArea[realCol][realRow] = 1;  //æ ‡è®°ä¸ºå›ºå®šæ–¹å—
 267   5                      }
 268   4                  }
 269   3              }
 270   2          }
 271   1      }
 272          
 273          /**
 274           * @brief  æ£€æŸ¥å¹¶æ¶ˆé™¤å·²æ»¡çš„è¡Œ
 275           * @param  æ— 
 276           * @retval æ¶ˆé™¤çš„è¡Œæ•°
 277           */
 278          unsigned char ClearFullLines(){
 279   1          unsigned char row, col, r;
 280   1          unsigned char linesCleared = 0, isFull = 0;
 281   1          
 282   1          //ä»åº•éƒ¨å‘ä¸Šæ£€æŸ¥æ¯ä¸€è¡Œ
 283   1          for(row = 0; row < GAME_HEIGHT; row++){
 284   2              isFull = 1;
 285   2             
 286   2              //æ£€æŸ¥å½“å‰è¡Œæ˜¯å¦å¡«æ»¡
 287   2              for(col = 0; col < GAME_WIDTH; col++){
 288   3                  if(gameArea[col][row] == 0){
 289   4                      isFull = 0;
 290   4                      break;
 291   4                  }
 292   3              }
 293   2              
 294   2              //å¦‚æœè¡Œå·²æ»¡ï¼Œæ¶ˆé™¤è¯¥è¡Œå¹¶å°†ä¸Šæ–¹æ‰€æœ‰è¡Œä¸‹ç§»
 295   2              if(isFull){
 296   3                  linesCleared++;
 297   3                  
 298   3                  //å°†å½“å‰è¡Œä¸Šæ–¹æ‰€æœ‰è¡Œä¸‹ç§»ä¸€è¡Œ
 299   3                  for(r = row; r < GAME_HEIGHT - 1; r++){
 300   4                      for(col = 0; col < GAME_WIDTH; col++){
 301   5                          gameArea[col][r] = gameArea[col][r + 1];
C51 COMPILER V9.60.7.0   MAIN                                                              08/16/2025 18:01:07 PAGE 6   

 302   5                      }
 303   4                  }
 304   3                  
 305   3                  //é¡¶éƒ¨è¡Œæ¸…ç©º
 306   3                  for(col = 0; col < GAME_WIDTH; col++){
 307   4                      gameArea[col][GAME_HEIGHT - 1] = 0;
 308   4                  }
 309   3                  
 310   3                  //é‡æ–°æ£€æŸ¥å½“å‰è¡Œï¼ˆå› ä¸ºä¸Šæ–¹è¡Œä¸‹ç§»åå¯èƒ½åˆå¡«æ»¡äº†ï¼‰
 311   3                  row--;
 312   3              }
 313   2          }
 314   1          
 315   1          if(linesCleared > 0){
 316   2              Score_Add(linesCleared);  //æ¶ˆé™¤è¡Œåå¢åŠ ç§¯åˆ†
 317   2          }
 318   1          
 319   1          return linesCleared;
 320   1      }
 321          
 322          /**
 323           * @brief  ç”Ÿæˆæ–°çš„æ´»åŠ¨æ–¹å—
 324           * @param  æ— 
 325           * @retval æ— 
 326           */
 327          void GenerateNewBlock(){
 328   1          //ä»ä¸‹ä¸€ä¸ªæ–¹å—ç±»å‹æ›´æ–°å½“å‰æ–¹å—
 329   1          curBlockType = nextBlockType;
 330   1          curRotate = rand() % 4;  //éšæœºæ—‹è½¬çŠ¶æ€
 331   1          curX = 3;  //åˆå§‹Xä½ç½®
 332   1          curY = 7;  //åˆå§‹Yä½ç½®ï¼ˆé¡¶éƒ¨åŒºåŸŸï¼‰
 333   1          nextBlockType = rand() % 4;  //é¢„ç”Ÿæˆä¸‹ä¸€ä¸ªæ–¹å—
 334   1          
 335   1          //è‹¥æ–°æ–¹å—åˆå§‹ä½ç½®å°±ç¢°æ’ï¼Œæ¸¸æˆç»“æŸ
 336   1          if(CheckCollision(curX, curY)){
 337   2              isGameOver = 1;
 338   2          }
 339   1      }
 340          
 341          /**
 342           * @brief  å¤„ç†æ–¹å—ä¸‹è½é€»è¾‘
 343           * @param  æ— 
 344           * @retval æ— 
 345           */
 346          void BlockFall(){
 347   1          if(isGameOver || isPaused){  //æ¸¸æˆç»“æŸæˆ–æš‚åœæ—¶ä¸å¤„ç†
 348   2              return;
 349   2          }
 350   1          
 351   1          //è®¡ç®—ä¸‹è½åçš„Yåæ ‡
 352   1          newY = curY - 1;
 353   1          
 354   1          if(!CheckCollision(curX, newY)){  //æ— ç¢°æ’ï¼Œå…è®¸ä¸‹è½
 355   2              curY = newY;
 356   2          }else{  //æœ‰ç¢°æ’ï¼Œå›ºå®šå½“å‰æ–¹å—å¹¶ç”Ÿæˆæ–°æ–¹å—
 357   2              FixBlock();
 358   2              ClearFullLines();  //æ£€æŸ¥å¹¶æ¶ˆé™¤å·²æ»¡çš„è¡Œ
 359   2              GenerateNewBlock();
 360   2          }
 361   1      }
 362          /**
 363           * @brief  æ–¹å—å·¦ç§»
C51 COMPILER V9.60.7.0   MAIN                                                              08/16/2025 18:01:07 PAGE 7   

 364           * @param  æ— 
 365           * @retval æ— 
 366           */
 367          void BlockMoveLeft(){
 368   1          if(isGameOver || isPaused) return;  //æ¸¸æˆç»“æŸæˆ–æš‚åœæ—¶ä¸å“åº”
 369   1          newX = curX - 1;      //è®¡ç®—å·¦ç§»åçš„Xåæ ‡
 370   1          if(!CheckCollision(newX, curY)){    //æ£€æµ‹æ— ç¢°æ’åˆ™ç§»åŠ¨
 371   2              curX = newX;
 372   2          }
 373   1      }
 374          
 375          /**
 376           * @brief  æ–¹å—å³ç§»
 377           * @param  æ— 
 378           * @retval æ— 
 379           */
 380          void BlockMoveRight(){
 381   1          if(isGameOver || isPaused) return;
 382   1          newX = curX + 1;      //è®¡ç®—å³ç§»åçš„Xåæ ‡
 383   1          if(!CheckCollision(newX, curY)){    //æ£€æµ‹æ— ç¢°æ’åˆ™ç§»åŠ¨
 384   2              curX = newX;
 385   2          }
 386   1      }
 387          
 388          /**
 389           * @brief  æ–¹å—ä¸‹ç§»
 390           * @param  æ— 
 391           * @retval æ— 
 392           */
 393          void BlockMoveDown(){
 394   1          if(isGameOver || isPaused) return;
 395   1          newY = curY - 1;      //è®¡ç®—ä¸‹ç§»åçš„Xåæ ‡
 396   1          if(!CheckCollision(newX, curY - 1)){    //æ£€æµ‹æ— ç¢°æ’åˆ™ç§»åŠ¨
 397   2              curY = newY;
 398   2          }
 399   1      }
 400          
 401          /**
 402           * @brief  æ–¹å—æ—‹è½¬ï¼ˆé¡ºæ—¶é’ˆï¼‰
 403           * @param  æ— 
 404           * @retval æ— 
 405           */
 406          void BlockRotate(){
 407   1          unsigned char oldRotate;
 408   1          if(isGameOver || isPaused) return;
 409   1          oldRotate = curRotate;          //ä¿å­˜å½“å‰æ—‹è½¬çŠ¶æ€
 410   1          curRotate = (curRotate + 1) % 4;              //è®¡ç®—æ–°æ—‹è½¬çŠ¶æ€ï¼ˆ0-3å¾ªç¯ï¼‰
 411   1          if(CheckCollision(curX, curY)){               //è‹¥æ—‹è½¬åç¢°æ’
 412   2              curRotate = oldRotate;                    //æ¢å¤åŸæ—‹è½¬çŠ¶æ€
 413   2          }
 414   1      }
 415          
 416          /**
 417           * @brief  å¤„ç†é”®ç›˜è¾“å…¥
 418           * @param  key æŒ‰é”®å€¼ï¼ˆ1-16ï¼Œæ¥è‡ªMatrixKey()ï¼‰
 419           * @retval æ— 
 420           */
 421          void HandleKeyInput(unsigned char key){
 422   1          switch(key){
 423   2              case 5:  //æŒ‰é”®5ï¼šå·¦ç§»
 424   2                  BlockMoveLeft();
 425   2                  break;
C51 COMPILER V9.60.7.0   MAIN                                                              08/16/2025 18:01:07 PAGE 8   

 426   2              case 7:  //æŒ‰é”®7ï¼šå³ç§»
 427   2                  BlockMoveRight();
 428   2                  break;
 429   2              case 6:  //æŒ‰é”®6ï¼šä¸‹ç§»
 430   2                  BlockMoveDown();
 431   2                  break;
 432   2              case 2:  //æŒ‰é”®2ï¼šæ—‹è½¬
 433   2                  BlockRotate();
 434   2                  break;
 435   2              case 14: //æŒ‰é”®4ï¼šæš‚åœ/ç»§ç»­ï¼ˆå¯é€‰ï¼‰
 436   2                  isPaused = ~isPaused;
 437   2                  break;
 438   2          }
 439   1      }
 440          
 441          /**
 442           * @brief  æ¸¸æˆç»“æŸåŠ¨ç”»
 443           * @param  æ— 
 444           * @retval æ— 
 445           */
 446          void GameOverAnimation(){
 447   1          unsigned char frame[8] = {0};
 448   1          unsigned char col;
 449   1          
 450   1          //æ ¹æ®åŠ¨ç”»çŠ¶æ€è®¾ç½®å¸§
 451   1          for(col = 0; col < 8; col++){
 452   2              //äº¤æ›¿æ˜¾ç¤ºåˆ—
 453   2              if((col % 2) == gameOverAnimState){
 454   3                  frame[col] = 0xFF;  //ç‚¹äº®æ•´åˆ—
 455   3              }else{
 456   3                  frame[col] = 0x00;  //ç†„ç­æ•´åˆ—
 457   3              }
 458   2          }
 459   1          
 460   1          MatrixLED_ShowFrame(frame);
 461   1      }
 462          
 463          /**
 464           * @brief  é‡ç½®æ¸¸æˆï¼ˆå¼€å§‹æ–°ä¸€å±€ï¼‰
 465           * @param  æ— 
 466           * @retval æ— 
 467           */
 468          void ResetGame(){
 469   1          unsigned char col, row;
 470   1          
 471   1          //æ¸…ç©ºæ¸¸æˆåŒºåŸŸ
 472   1          for(col = 0; col < GAME_WIDTH; col++){
 473   2              for(row = 0; row < GAME_HEIGHT; row++){
 474   3                  gameArea[col][row] = 0;
 475   3              }
 476   2          }
 477   1          
 478   1          //é‡æ–°åˆå§‹åŒ–æ¸¸æˆçŠ¶æ€
 479   1          isGameOver = 0;
 480   1          isPaused = 0;
 481   1          Score_Init();
 482   1          
 483   1          //ç”Ÿæˆæ–°æ–¹å—
 484   1          curBlockType = rand() % 4;
 485   1          curRotate = rand() % 4;
 486   1          curX = 3;
 487   1          curY = 7;
C51 COMPILER V9.60.7.0   MAIN                                                              08/16/2025 18:01:07 PAGE 9   

 488   1          nextBlockType = rand() % 4;
 489   1      }
 490          
 491          void main(){
 492   1          //æ¸¸æˆåˆå§‹åŒ–
 493   1          GameInit();
 494   1          
 495   1          //æ¸¸æˆä¸»å¾ªç¯
 496   1          while(1){
 497   2              //å¤„ç†å®šæ—¶ä¸‹è½
 498   2              if(blockFallFlag == 1){
 499   3                  blockFallFlag = 0;
 500   3                  BlockFall();
 501   3              }
 502   2              
 503   2              //å¤„ç†é”®ç›˜è¾“å…¥
 504   2              key = NonBlockKey_GetKey();  //ä½¿ç”¨éé˜»å¡é”®ç›˜å‡½æ•°
 505   2              if(key != 0){
 506   3                  if(isGameOver){
 507   4                      //æ¸¸æˆç»“æŸæ—¶ï¼ŒæŒ‰16å·é”®é‡æ–°å¼€å§‹
 508   4                      if(key == 16){
 509   5                          ResetGame();
 510   5                      }
 511   4                  }else{
 512   4                      HandleKeyInput(key);
 513   4                  }
 514   3              }
 515   2              
 516   2              //ç»˜åˆ¶ç”»é¢
 517   2              if(isGameOver){
 518   3                  GameOverAnimation();
 519   3              }else{
 520   3                  DrawGame();
 521   3              }
 522   2          }
 523   1      }
 524          
 525          //å®šæ—¶å™¨ä¸­æ–­å‡½æ•°
 526          void Timer0_Routine() interrupt 1{
 527   1          static unsigned int T0Count;
 528   1          static unsigned int animCount;
 529   1          
 530   1          //é‡æ–°èµ‹åˆå€¼ä¿è¯è®¡æ—¶ä¸º1ms
 531   1          TL0 = 0x66;       //è®¾ç½®å®šæ—¶åˆå§‹å€¼
 532   1          TH0 = 0xFC;       //è®¾ç½®å®šæ—¶åˆå§‹å€¼
 533   1          
 534   1          //é”®ç›˜æ‰«æï¼ˆæ¯1msæ‰«æä¸€æ¬¡ï¼‰
 535   1          NonBlockKey_Scan();
 536   1          
 537   1          if(isGameOver){
 538   2              //æ¸¸æˆç»“æŸæ—¶æ›´æ–°åŠ¨ç”»è®¡æ•°å™¨
 539   2              animCount++;
 540   2              if(animCount >= 200){  //çº¦200msåˆ‡æ¢ä¸€æ¬¡çŠ¶æ€
 541   3                  animCount = 0;
 542   3                  gameOverAnimState = ~gameOverAnimState;
 543   3              }
 544   2          }else{
 545   2              //æ­£å¸¸æ¸¸æˆæ—¶å¤„ç†æ–¹å—ä¸‹è½
 546   2              T0Count++;
 547   2              if (T0Count >= Score_GetFallInterval()){
 548   3                  T0Count = 0; //åˆå§‹åŒ–è®¡æ•°
 549   3                  blockFallFlag = 1; //ç½®ä½ä¸‹è½æ ‡å¿—
C51 COMPILER V9.60.7.0   MAIN                                                              08/16/2025 18:01:07 PAGE 10  

 550   3              }
 551   2          }
 552   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   1124    ----
   CONSTANT SIZE    =    160    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     95      23
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      4    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
