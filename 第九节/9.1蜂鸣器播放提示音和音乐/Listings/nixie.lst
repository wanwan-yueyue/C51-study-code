C51 COMPILER V9.60.7.0   NIXIE                                                             08/03/2025 14:49:06 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE NIXIE
OBJECT MODULE PLACED IN .\Objects\nixie.obj
COMPILER INVOKED BY: C:\keil_C51\C51\BIN\C51.EXE nixie.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\ni
                    -xie.lst) TABS(2) OBJECT(.\Objects\nixie.obj)

line level    source

   1          #include "nixie.h"
   2          #include "delay.h"
   3          #include <REGX52.H>
   4          
   5          // 数码管段码表，存储在ROM中
   6          const unsigned char NixieTable[] = {
   7              0x3F, // 0
   8              0x06, // 1
   9              0x5B, // 2
  10              0x4F, // 3
  11              0x66, // 4
  12              0x6D, // 5
  13              0x7D, // 6
  14              0x07, // 7
  15              0x7F, // 8
  16              0x6F  // 9
  17          };
  18          
  19          // 宏定义简化位操作
  20          #define DIGIT_SEL_PORT P2
  21          #define DIGIT_DATA_PORT P0
  22          
  23          /**
  24           * @brief 设置数码管位置（内部函数）
  25           * @param location 位置参数(1-8)
  26           */
  27          static void SetDigitPosition(unsigned char location)
  28          {
  29   1          // 仅保留低3位，自动限制在0-7范围
  30   1          unsigned char pos_code = (location - 1) & 0x07;
  31   1          
  32   1          // 先关闭所有位选
  33   1          DIGIT_SEL_PORT &= ~(0x1C);  // 清除P2_4-P2_2位
  34   1          
  35   1          // 设置新的位选信号
  36   1          if(pos_code & 0x04) 
  37   1              DIGIT_SEL_PORT &= ~(1<<4); // 第2位
  38   1          else 
  39   1              DIGIT_SEL_PORT |= (1<<4);
  40   1          
  41   1          if(pos_code & 0x02) 
  42   1              DIGIT_SEL_PORT &= ~(1<<3); // 第1位
  43   1          else 
  44   1              DIGIT_SEL_PORT |= (1<<3);
  45   1          
  46   1          if(pos_code & 0x01) 
  47   1              DIGIT_SEL_PORT &= ~(1<<2); // 第0位
  48   1          else 
  49   1              DIGIT_SEL_PORT |= (1<<2);
  50   1      }
  51          
  52          /**
  53           * @brief 数码管显示函数
  54           * @param location 数码管位置(1-8)
C51 COMPILER V9.60.7.0   NIXIE                                                             08/03/2025 14:49:06 PAGE 2   

  55           * @param number 要显示的数字(0-9)，超过9将显示横杠
  56           * @note 如果需要静态显示，可以关闭消隐处理
  57           */
  58          void NixieDisplay(unsigned char location, unsigned char number)
  59          {
  60   1        // 边界检查，非法位置不显示
  61   1        if(location < 1 || location > 8)
  62   1          return;
  63   1        
  64   1        // 数字越界处理，显示特殊符号(此处显示横杠)
  65   1        if(number > 9)
  66   1          number = 0x40; // 横杠的段码
  67   1        else
  68   1          number = NixieTable[number];
  69   1        
  70   1        // 关闭显示，防止位选切换时的串扰
  71   1        DIGIT_DATA_PORT = 0x00;
  72   1        
  73   1        // 设置位选
  74   1        SetDigitPosition(location);
  75   1        
  76   1        // 输出段码
  77   1        DIGIT_DATA_PORT = number;
  78   1        
  79   1        // 短暂延时，保证显示亮度
  80   1        Delay1ms(1);
  81   1        
  82   1        // 消影处理
  83   1        //DIGIT_DATA_PORT = 0x00;
  84   1      }
  85              


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =     86    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     10    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
