C51 COMPILER V9.60.7.0   KEY                                                               09/05/2025 20:26:05 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE KEY
OBJECT MODULE PLACED IN .\Objects\Key.obj
COMPILER INVOKED BY: C:\keil_C51\C51\BIN\C51.EXE ..\Ä£¿é\Key.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listi
                    -ngs\Key.lst) TABS(2) OBJECT(.\Objects\Key.obj)

line level    source

   1          #include <REGX52.H>
   2          #include "delay.h"
   3          
   4          // å®šä¹‰æŒ‰é”®å¼•è„š
   5          #define KEY1 P3_1
   6          #define KEY2 P3_0
   7          #define KEY3 P3_2
   8          #define KEY4 P3_3
   9          
  10          /**
  11           * åŠŸèƒ½ï¼šæ‰«æå•ä¸ªæŒ‰é”®çŠ¶æ€ï¼ˆé€šè¿‡å‡½æ•°å‚æ•°åŒºåˆ†ä¸åŒæŒ‰é”®ï¼‰
  12           * å‚æ•°ï¼š
  13           *   keyIndexï¼šæŒ‰é”®ç¼–å·ï¼ˆ1-4ï¼Œå¯¹åº”K1-K4ï¼‰
  14           * è¿”å›ï¼šæŒ‰é”®æŒ‰ä¸‹æ—¶è¿”å›å¯¹åº”ç¼–å·ï¼Œå¦åˆ™è¿”å›0
  15           */
  16          static unsigned char scanSingleKey(unsigned char keyIndex) {
  17   1          // æ ¹æ®æŒ‰é”®ç¼–å·åˆ¤æ–­å¯¹åº”å¼•è„šçŠ¶æ€
  18   1          bit pinState = 1;  // é»˜è®¤ä¸ºé«˜ç”µå¹³ï¼ˆæœªæŒ‰ä¸‹ï¼‰
  19   1          switch(keyIndex) {
  20   2              case 1: pinState = KEY1; break;  // è¯»å–K1å¼•è„š
  21   2              case 2: pinState = KEY2; break;  // è¯»å–K2å¼•è„š
  22   2              case 3: pinState = KEY3; break;  // è¯»å–K3å¼•è„š
  23   2              case 4: pinState = KEY4; break;  // è¯»å–K4å¼•è„š
  24   2          }
  25   1      
  26   1          // æŒ‰é”®æŒ‰ä¸‹æ£€æµ‹ï¼ˆå¼•è„šä¸ºä½ç”µå¹³ï¼‰
  27   1          if (pinState == 0) {
  28   2              Delay1ms(20);  // æ¶ˆæŠ–
  29   2              // å†æ¬¡æ£€æµ‹ç¡®è®¤æŒ‰ä¸‹
  30   2              switch(keyIndex) {
  31   3                  case 1: pinState = KEY1; break;
  32   3                  case 2: pinState = KEY2; break;
  33   3                  case 3: pinState = KEY3; break;
  34   3                  case 4: pinState = KEY4; break;
  35   3              }
  36   2              if (pinState == 0) {
  37   3                  // ç­‰å¾…æŒ‰é”®é‡Šæ”¾
  38   3                  while(pinState == 0) {
  39   4                      switch(keyIndex) {
  40   5                          case 1: pinState = KEY1; break;
  41   5                          case 2: pinState = KEY2; break;
  42   5                          case 3: pinState = KEY3; break;
  43   5                          case 4: pinState = KEY4; break;
  44   5                      }
  45   4                  }
  46   3                  Delay1ms(20);  // é‡Šæ”¾åæ¶ˆæŠ–
  47   3                  return keyIndex;  // è¿”å›æŒ‰é”®ç¼–å·
  48   3              }
  49   2          }
  50   1          return 0;  // æœªæŒ‰ä¸‹è¿”å›0
  51   1      }
  52          
  53          /**
  54           * åŠŸèƒ½ï¼šè·å–ç‹¬ç«‹æŒ‰é”®é”®å€¼
C51 COMPILER V9.60.7.0   KEY                                                               09/05/2025 20:26:05 PAGE 2   

  55           * è¿”å›ï¼š1-4ï¼ˆå¯¹åº”K1-K4ï¼‰ï¼Œæ— æŒ‰é”®æŒ‰ä¸‹è¿”å›0
  56           */
  57          unsigned char Key() {
  58   1          unsigned char keyValue = 0;
  59   1      
  60   1          // ä¾æ¬¡æ‰«æ4ä¸ªæŒ‰é”®ï¼ˆé¿å…åŒæ—¶æŒ‰ä¸‹æ—¶å†²çªï¼Œä¼˜å…ˆè¯†åˆ«å…ˆæ‰«æçš„æŒ‰é”®ï¼‰
  61   1          if (keyValue == 0) {
  62   2              keyValue = scanSingleKey(1);  // æ‰«æK1
  63   2          }
  64   1          if (keyValue == 0) {
  65   2              keyValue = scanSingleKey(2);  // æ‰«æK2
  66   2          }
  67   1          if (keyValue == 0) {
  68   2              keyValue = scanSingleKey(3);  // æ‰«æK3
  69   2          }
  70   1          if (keyValue == 0) {
  71   2              keyValue = scanSingleKey(4);  // æ‰«æK4
  72   2          }
  73   1      
  74   1          return keyValue;
  75   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    182    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----       1
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----       1
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
