C51 COMPILER V9.60.7.0   MAIN                                                              08/06/2025 21:54:47 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: C:\keil_C51\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\mai
                    -n.lst) TABS(2) OBJECT(.\Objects\main.obj)

line level    source

   1          #include <REGX52.H>
   2          #include "Key.h"
   3          #include "nixie.h"
   4          #include "Buzzer.h"
   5          #include "delay.h"
   6          #include "Timer0.h"
   7          
   8          
   9          unsigned char KeyNum, i = 0;
  10          
  11          // 定义结构体，格式：{基础频率, 音名, 音符类型}
  12          typedef struct {
  13              float freq;
  14              NoteName name;
  15              unsigned int type;
  16          } Note;
  17          
  18          // 欢乐颂音符序列（C大调）
  19          const Note code odeToJoy[] = {
  20            //(1)
  21              {e2,  NOTE_E,  QUARTER_NOTE},    // 3
  22              {e2,  NOTE_E,  QUARTER_NOTE},    // 3
  23              {f2,  NOTE_F,  QUARTER_NOTE},    // 4
  24              {g2,  NOTE_G,  QUARTER_NOTE},    // 5
  25              
  26              {g2,  NOTE_G,  QUARTER_NOTE},    // 5
  27              {f2,  NOTE_F,  QUARTER_NOTE},    // 4
  28              {e2,  NOTE_E,  QUARTER_NOTE},    // 3
  29              {d2,  NOTE_D,  QUARTER_NOTE},    // 2
  30              
  31              {c2,  NOTE_C,  QUARTER_NOTE},    // 1
  32              {c2,  NOTE_C,  QUARTER_NOTE},    // 1
  33              {d2,  NOTE_D,  QUARTER_NOTE},    // 2
  34              {e2,  NOTE_E,  QUARTER_NOTE},    // 3
  35              
  36              {e2,  NOTE_E,  DOT_QUARTER_NOTE}, // 3（附点四分音符）
  37              {d2,  NOTE_D,  EIGHTH_NOTE},     // 2（八分音符）
  38              {d2,  NOTE_D,  HALF_NOTE},      // 2（二分音符）
  39              
  40              {e2,  NOTE_E,  QUARTER_NOTE},    // 3
  41              {e2,  NOTE_E,  QUARTER_NOTE},    // 3
  42              {f2,  NOTE_F,  QUARTER_NOTE},    // 4
  43              {g2,  NOTE_G,  QUARTER_NOTE},    // 5
  44              
  45            //(6)
  46              {g2,  NOTE_G,  QUARTER_NOTE},    // 5
  47              {f2,  NOTE_F,  QUARTER_NOTE},    // 4
  48              {e2,  NOTE_E,  QUARTER_NOTE},    // 3
  49              {d2,  NOTE_D,  QUARTER_NOTE},    // 2
  50              
  51              {c2,  NOTE_C,  QUARTER_NOTE},    // 1
  52              {c2,  NOTE_C,  QUARTER_NOTE},    // 1
  53              {d2,  NOTE_D,  QUARTER_NOTE},    // 2
  54              {e2,  NOTE_E,  QUARTER_NOTE},    // 3
C51 COMPILER V9.60.7.0   MAIN                                                              08/06/2025 21:54:47 PAGE 2   

  55              
  56              {d2,  NOTE_D,  DOT_QUARTER_NOTE}, // 2（附点四分音符）
  57              {c2,  NOTE_C,  EIGHTH_NOTE},     // 1（八分音符）
  58              {c2,  NOTE_C,  HALF_NOTE},      // 1（二分音符）
  59              
  60              {d2,  NOTE_D,  QUARTER_NOTE},    // 2
  61              {d2,  NOTE_D,  QUARTER_NOTE},    // 2
  62              {e2,  NOTE_E,  QUARTER_NOTE},    // 3
  63              {c2,  NOTE_C,  QUARTER_NOTE},    // 1
  64              
  65              {d2,  NOTE_D,  QUARTER_NOTE},    // 2
  66              {e2,  NOTE_E,  EIGHTH_NOTE},     // 3（八分音符）
  67              {f2,  NOTE_F,  EIGHTH_NOTE},     // 4（八分音符）
  68              {e2,  NOTE_E,  QUARTER_NOTE},    // 3
  69              {c2,  NOTE_C,  QUARTER_NOTE},    // 1
  70              
  71            //(11)
  72              {d2,  NOTE_D,  QUARTER_NOTE},    // 2
  73              {e2,  NOTE_E,  EIGHTH_NOTE},     // 3（八分音符）
  74              {f2,  NOTE_F,  EIGHTH_NOTE},     // 4（八分音符）
  75              {e2,  NOTE_E,  QUARTER_NOTE},    // 3
  76              {d2,  NOTE_D,  QUARTER_NOTE},    // 2
  77              
  78              {c2,  NOTE_C,  QUARTER_NOTE},    // 1
  79              {d2,  NOTE_D,  QUARTER_NOTE},    // 2
  80              {g1,  NOTE_G,  QUARTER_NOTE},    // 5(LOW1)
  81              {e2,  NOTE_E,  HALF_NOTE},       // 3
  82              {e2,  NOTE_E,  QUARTER_NOTE},    // 3
  83              {f2,  NOTE_F,  QUARTER_NOTE},    // 4
  84              {g2,  NOTE_G,  QUARTER_NOTE},    // 5
  85              
  86              {g2,  NOTE_G,  QUARTER_NOTE},    // 5
  87              {f2,  NOTE_F,  QUARTER_NOTE},    // 4
  88              {e2,  NOTE_E,  QUARTER_NOTE},    // 3
  89              {d2,  NOTE_D,  QUARTER_NOTE},    // 2
  90              
  91              {c2,  NOTE_C,  QUARTER_NOTE},    // 1
  92              {c2,  NOTE_C,  QUARTER_NOTE},    // 1
  93              {d2,  NOTE_D,  QUARTER_NOTE},    // 2
  94              {e2,  NOTE_E,  QUARTER_NOTE},    // 3
  95              
  96            //(16)
  97              {d2,  NOTE_D,  DOT_QUARTER_NOTE}, // 2（附点四分音符）
  98              {c2,  NOTE_C,  EIGHTH_NOTE},     // 1（八分音符）
  99              {c2,  NOTE_C,  HALF_NOTE},      // 1（二分音符）
 100              
 101          //    {d2,  NOTE_D,  QUARTER_NOTE},    // 2
 102          //    {d2,  NOTE_D,  QUARTER_NOTE},    // 2
 103          //    {e2,  NOTE_E,  QUARTER_NOTE},    // 3
 104          //    {c2,  NOTE_C,  QUARTER_NOTE},    // 1
 105          //    
 106          //    {d2,  NOTE_D,  QUARTER_NOTE},    // 2
 107          //    {e2,  NOTE_E,  EIGHTH_NOTE},     // 3（八分音符）
 108          //    {f2,  NOTE_F,  EIGHTH_NOTE},     // 4（八分音符）
 109          //    {e2,  NOTE_E,  QUARTER_NOTE},    // 3
 110          //    {c2,  NOTE_C,  QUARTER_NOTE},    // 1
 111          //    
 112          //    {d2,  NOTE_D,  QUARTER_NOTE},    // 2
 113          //    {e2,  NOTE_E,  EIGHTH_NOTE},     // 3（八分音符）
 114          //    {f2,  NOTE_F,  EIGHTH_NOTE},     // 4（八分音符）
 115          //    {e2,  NOTE_E,  QUARTER_NOTE},    // 3
 116          //    {d2,  NOTE_D,  QUARTER_NOTE},    // 2
C51 COMPILER V9.60.7.0   MAIN                                                              08/06/2025 21:54:47 PAGE 3   

 117          //    
 118          //    {c2,  NOTE_C,  QUARTER_NOTE},    // 1
 119          //    {d2,  NOTE_D,  QUARTER_NOTE},    // 2
 120          //    {g1,  NOTE_G,  QUARTER_NOTE},    // 5(LOW1)
 121          //    {e2,  NOTE_E,  HALF_NOTE},       // 3
 122          //    
 123          //  //(21)
 124          //    {e2,  NOTE_E,  QUARTER_NOTE},    // 3
 125          //    {f2,  NOTE_F,  QUARTER_NOTE},    // 4
 126          //    {g2,  NOTE_G,  QUARTER_NOTE},    // 5
 127          //    
 128          //    {g2,  NOTE_G,  QUARTER_NOTE},    // 5
 129          //    {f2,  NOTE_F,  QUARTER_NOTE},    // 4
 130          //    {e2,  NOTE_E,  QUARTER_NOTE},    // 3
 131          //    {d2,  NOTE_D,  QUARTER_NOTE},    // 2
 132          //    
 133          //    {c2,  NOTE_C,  QUARTER_NOTE},    // 1
 134          //    {c2,  NOTE_C,  QUARTER_NOTE},    // 1
 135          //    {d2,  NOTE_D,  QUARTER_NOTE},    // 2
 136          //    {e2,  NOTE_E,  QUARTER_NOTE},    // 3
 137          //    
 138          //    {d2,  NOTE_D,  DOT_QUARTER_NOTE}, // 2（附点四分音符）
 139          //    {c2,  NOTE_C,  EIGHTH_NOTE},     // 1（八分音符）
 140          //    {c2,  NOTE_C,  HALF_NOTE},      // 1（二分音符）
 141              
 142              {0,   NOTE_C,  0}                // 结束标志
 143          };
 144          
 145          //虫儿飞音符序列(F大调)
 146          const Note code bugsFly[] = {
 147            //(1)
 148              {e2,  NOTE_E,  QUARTER_NOTE},    // 3
 149              {e2,  NOTE_E,  EIGHTH_NOTE},     // 3(八分音符)
 150              {e2,  NOTE_E,  EIGHTH_NOTE},     // 3(八分音符)
 151              {f2,  NOTE_F,  QUARTER_NOTE},    // 4
 152              {g2,  NOTE_G,  QUARTER_NOTE},    // 5
 153              
 154              {e2,  NOTE_E,  DOT_QUARTER_NOTE},    // 3(附点四分音符)
 155              {d2,  NOTE_D,  EIGHTH_NOTE},     // 2(八分音符)
 156              {d2,  NOTE_D,  HALF_NOTE},     // 2(二分音符)
 157              
 158              {c2,  NOTE_C,  QUARTER_NOTE},    // 1
 159              {c2,  NOTE_C,  EIGHTH_NOTE},     // 1(八分音符)
 160              {c2,  NOTE_C,  EIGHTH_NOTE},     // 1(八分音符)
 161              {d2,  NOTE_D,  QUARTER_NOTE},    // 2
 162              {e2,  NOTE_E,  QUARTER_NOTE},    // 3
 163              
 164              {e2,  NOTE_E,  DOT_QUARTER_NOTE},    // 3(附点四分音符)
 165              {b1,  NOTE_B,  EIGHTH_NOTE},     // 7(LOW1, 八分音符)
 166              {b1,  NOTE_B,  HALF_NOTE},     // 7(LOW1, 二分音符)
 167              
 168            //(5)
 169              {a1,  NOTE_A,  QUARTER_NOTE},    // 6(LOW1)
 170              {e2,  NOTE_E,  QUARTER_NOTE},    // 3
 171              {d2,  NOTE_D,  HALF_NOTE},     // 2(二分音符)
 172              
 173              {a1,  NOTE_A,  QUARTER_NOTE},    // 6(LOW1)
 174              {e2,  NOTE_E,  QUARTER_NOTE},    // 3
 175              {d2,  NOTE_D,  HALF_NOTE},     // 2(二分音符)
 176              
 177              {a1,  NOTE_A,  QUARTER_NOTE},    // 6(LOW1)
 178              {e2,  NOTE_E,  QUARTER_NOTE},    // 3
C51 COMPILER V9.60.7.0   MAIN                                                              08/06/2025 21:54:47 PAGE 4   

 179              {d2,  NOTE_D,  DOT_QUARTER_NOTE},    // 2(附点四分音符)
 180              {c2,  NOTE_C,  EIGHTH_NOTE},     // 1(八分音符)
 181              
 182              {c2,  NOTE_C,  WHOLE_NOTE},    // 1(全音符)
 183                
 184              {0,   NOTE_C,  0}                // 结束标志
 185          };
 186          
 187          
 188          void main(){
 189   1        
 190   1        //蜂鸣器初始化,设置调号为C大调,指定bpm = 120
 191   1        Buzzer_Init(120, C_MAJOR);
 192   1        //定时器初始化
 193   1        Timer0Init();
 194   1        
 195   1        NixieDisplay(1,0);
 196   1        
 197   1        while(1){
 198   2          
 199   2          KeyNum = Key();
 200   2          if(KeyNum == 1){
 201   3              NixieDisplay(1,1);
 202   3              // 播放旋律
 203   3              Buzzer_SetBPM(96);  //设定BPM为96
 204   3              Buzzer_SetKeySignature(C_MAJOR);   //修改调号为C大调
 205   3              if(TR0 == 0){TR0 = 1;}  //启动定时器
 206   3              while(odeToJoy[i].freq != 0) {
 207   4                  Buzzer_PlayNote(
 208   4                      odeToJoy[i].freq, 
 209   4                      odeToJoy[i].name, 
 210   4                      odeToJoy[i].type
 211   4                  );
 212   4                  // 音符间短暂停顿（避免连音）
 213   4                  // Delay1ms(50);
 214   4                  i++;
 215   4              }
 216   3          }
 217   2          if(KeyNum == 2){
 218   3              NixieDisplay(1,2);
 219   3              // 播放旋律
 220   3              Buzzer_SetBPM(103);   //设定BPM为103
 221   3              Buzzer_SetKeySignature(F_MAJOR);   //修改调号为F大调
 222   3              if(TR0 == 0){TR0 = 1;}  //启动定时器
 223   3              while(bugsFly[i].freq != 0) {
 224   4                  Buzzer_PlayNote(
 225   4                      bugsFly[i].freq, 
 226   4                      bugsFly[i].name, 
 227   4                      bugsFly[i].type
 228   4                  );
 229   4                  // 音符间短暂停顿（避免连音）
 230   4                  // Delay1ms(50);
 231   4                  i++;
 232   4              }
 233   3          }
 234   2          if(KeyNum == 4){
 235   3              NixieDisplay(1,4);
 236   3              //重新开始
 237   3              if(TR0 == 1){TR0 = 0;}  //关闭定时器
 238   3              i = 0;
 239   3          }
 240   2          
C51 COMPILER V9.60.7.0   MAIN                                                              08/06/2025 21:54:47 PAGE 5   

 241   2        }
 242   1        
 243   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    306    ----
   CONSTANT SIZE    =    637    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      2    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
