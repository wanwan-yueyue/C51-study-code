C51 COMPILER V9.60.7.0   MATRIXLED                                                         07/27/2025 13:49:10 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE MATRIXLED
OBJECT MODULE PLACED IN .\Objects\MatrixLED.obj
COMPILER INVOKED BY: C:\keil_C51\C51\BIN\C51.EXE ..\7.1LEDµãÕóÆÁÏÔÊ¾Í¼ĞÎ\MatrixLED.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJE
                    -CTEXTEND PRINT(.\Listings\MatrixLED.lst) TABS(2) OBJECT(.\Objects\MatrixLED.obj)

line level    source

   1          #include "MatrixLED.h"
   2          #include "delay.h"
   3          
   4          /**
   5           * @brief å‘74HC595å†™å…¥ä¸€ä¸ªå­—èŠ‚
   6           * @param Byte è¦å†™å…¥çš„å­—èŠ‚
   7           */
   8          void _74HC595_WriteByte(unsigned char Byte)
   9          {
  10   1          unsigned char i;
  11   1          for(i = 0; i < 8; i++)
  12   1          {
  13   2              SER = Byte & (0x80 >> i);
  14   2              SCK = 1;
  15   2              SCK = 0;
  16   2          }
  17   1          RCK = 1;
  18   1          RCK = 0;
  19   1      }
  20          
  21          /**
  22           * @brief åˆå§‹åŒ–ç‚¹é˜µå±
  23           */
  24          void MatrixLED_Init(void)
  25          {
  26   1          SCK = 0;
  27   1          RCK = 0;
  28   1      }
  29          
  30          /**
  31           * @brief æ˜¾ç¤ºä¸€åˆ—æ•°æ®
  32           * @param Column åˆ—å·(0-7)
  33           * @param Data åˆ—æ•°æ®(1ä¸ºäº®ï¼Œ0ä¸ºç­)
  34           */
  35          void MatrixLED_ShowColumn(unsigned char Column, unsigned char Data)
  36          {
  37   1          _74HC595_WriteByte(Data);
  38   1          MATRIX_LED_PORT = ~(0x80 >> Column);
  39   1          Delay1ms(1);
  40   1          MATRIX_LED_PORT = 0xFF;
  41   1      }
  42          
  43          /**
  44           * @brief æ˜¾ç¤ºä¸€å¸§å®Œæ•´å›¾åƒ
  45           * @param Frame æŒ‡å‘å¸§æ•°æ®çš„æŒ‡é’ˆï¼Œéœ€åŒ…å«8ä¸ªå­—èŠ‚
  46           */
  47          void MatrixLED_ShowFrame(const unsigned char *Frame)
  48          {
  49   1          unsigned char i;
  50   1          for(i = 0; i < 8; i++)
  51   1          {
  52   2              MatrixLED_ShowColumn(i, Frame[i]);
  53   2          }
  54   1      }
C51 COMPILER V9.60.7.0   MATRIXLED                                                         07/27/2025 13:49:10 PAGE 2   

  55          
  56          /**
  57           * @brief æ’­æ”¾åŠ¨ç”»
  58           * @param Animation æŒ‡å‘åŠ¨ç”»æ•°æ®çš„æŒ‡é’ˆ
  59           * @param FrameCount åŠ¨ç”»å¸§æ•°
  60           * @param Speed åŠ¨ç”»é€Ÿåº¦(æ•°å€¼è¶Šå¤§è¶Šæ…¢)
  61           */
  62          void MatrixLED_PlayAnimation(const unsigned char *Animation, unsigned char FrameCount, unsigned int Speed)
  63          {
  64   1          static unsigned char Offset = 0;
  65   1          static unsigned int Count = 0;
  66   1          unsigned char i;
  67   1          
  68   1          // æ˜¾ç¤ºå½“å‰å¸§çš„8åˆ—æ•°æ®
  69   1          for(i = 0; i < 8; i++)
  70   1          {
  71   2              MatrixLED_ShowColumn(i, Animation[i + Offset]);
  72   2          }
  73   1          
  74   1          // é€Ÿåº¦æ§åˆ¶
  75   1          Count++;
  76   1          if(Count > Speed)
  77   1          {
  78   2              Count = 0;
  79   2              Offset += 8;  // åç§»8ä½ï¼Œåˆ‡æ¢åˆ°ä¸‹ä¸€å¸§
  80   2              
  81   2              // åŠ¨ç”»æ’­æ”¾å®Œæ¯•ï¼Œå›åˆ°ç¬¬ä¸€å¸§
  82   2              if(Offset >= FrameCount * 8)
  83   2              {
  84   3                  Offset = 0;
  85   3              }
  86   2          }
  87   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    224    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      3      11
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
